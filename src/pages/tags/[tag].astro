---
import IndexPageLayout from '../../layouts/IndexPageLayout.astro';
import { getAndGroupUniqueTags } from '../../lib/utils';
import ProjectCard from '../../components/ProjectCard.astro';

interface Props {
  items: any[];
}

export async function getStaticPaths(): Promise<
  Array<{
    params: { tag: string };
    props: { items: any[] };
  }>
> {
  const tagItemsMap = await getAndGroupUniqueTags();

  const result: Array<{
    params: { tag: string };
    props: { items: any[] };
  }> = [];

  tagItemsMap.forEach((items, tag) => {
    result.push({
      params: { tag },
      props: { items },
    });
  });

  return result;
}

const { tag } = Astro.params;
const { items } = Astro.props;
---

<IndexPageLayout
  title={tag}
  description="A new dimension to access content of this website"
  subTitle={tag}
>
  <div class="flex flex-col gap-3">
    {
      items?.map((post) => (
        <>
          <ProjectCard
            url={`/posts/${post.slug}/`}
            heading={post.data.title}
            subheading={post.data.description}
            imagePath={post.data?.image?.url}
            altText={post.data?.image?.alt}
            dateStart={post.data.startDate}
          />
        </>
      ))
    }
  </div>
</IndexPageLayout>
